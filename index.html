<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Recipes Notebook</title>
  <link rel="stylesheet" href="src/style.css">
</head>

<body>
  <main>
    <ul class="cards" style="--total: 10;">
      <!-- Sheet 0: Front=Cover, Back=Recipe 1 Title/Photo -->
      <li class="card" style="--i: 0;">
        <div class="page">
          <div class="front cover-front">
            <h1>Cocktail<br>Recipes</h1>
            <p>A Collection of Classics</p>
          </div>
          <div class="back plain-page">
            <div class="recipe-intro">
              <h2>Angustura Collins</h2>
              <picture>
                <source type="image/avif"
                  srcset="/images/angustura_collins_2x.avif 2x, /images/angustura_collins_1x.avif 1x">
                <img src="/images/angustura_collins_1x.png" alt="Angustura Collins" width="340" height="480" />
              </picture>
            </div>
          </div>
        </div>
      </li>

      <!-- Sheet 1: Front=Recipe 1 Content, Back=Recipe 2 Title/Photo -->
      <li class="card" style="--i: 1;">
        <div class="page">
          <div class="front ruled-page">
            <div class="recipe-content">
              <h3>Ingredients</h3>
              <ul class="ingredients">
                <li>1&frac12; oz Angustura bitters</li>
                <li>1&frac12; oz lemon juice</li>
                <li>1&frac12; oz soda water</li>
                <li>&frac12; oz simple syrup</li>
                <li>lemon peel to garnish</li>
              </ul>
              <h3>Instructions</h3>
              <p class="instructions">Shake the lemon juice (1&frac12; oz) and simple syrup (1&frac12; oz) vigorously
                over ice. Strain into tom collins glass. Add soda water (1&frac12; oz) and stir gently to combine.
                Float the Angustura (1&frac12; oz) using a spoon. Add lemon peel to garnish after rubbing around
                the rim of the glass.</p>
            </div>
          </div>
          <div class="back plain-page">
            <div class="recipe-intro">
              <h2>Cherry Fizz</h2>
              <picture>
                <source type="image/avif" srcset="/images/cherry_fizz_2x.avif 2x, /images/cherry_fizz_1x.avif 1x">
                <img src="/images/cherry_fizz_1x.png" alt="Cherry Fizz" width="340" height="480" />
              </picture>
            </div>
          </div>
        </div>
      </li>

      <!-- Sheet 2: Front=Recipe 2 Content, Back=Recipe 3 Title/Photo -->
      <li class="card" style="--i: 2;">
        <div class="page">
          <div class="front ruled-page">
            <div class="recipe-content">
              <h3>Ingredients <span>(serves 4)</span></h3>
              <ul class="ingredients">
                <li>4 ounces gin</li>
                <li>4 ounces Liqueur Griottine Morand cherry brandy</li>
                <li>3 ounces fresh lemon juice</li>
                <li>1&frac12; ounces rich simple syrup (2:1)</li>
                <li>4 large egg whites</li>
                <li>1 ounce heavy cream</li>
                <li>&frac14; ounce orange blossom water</li>
                <li>12 ounces soda water</li>
                <li>Luxardo cherries, for garnish</li>
              </ul>
              <h3>Instructions</h3>
              <p class="instructions">In a cocktail shaker, immersion blend everything except for the soda water and
                cherries. Add ice and the soda water. Shake and strain into 4 chilled fizz glasses. Garnish with
                cherries.</p>
            </div>
          </div>
          <div class="back plain-page">
            <div class="recipe-intro">
              <h2>La Bicyclette</h2>
              <picture>
                <source type="image/avif"
                  srcset="/images/aged_la_bicyclette_2x.avif 2x, /images/aged_la_bicyclette_1x.png 1x">
                <img src="/images/aged_la_bicyclette_1x.png"
                  alt="Photograph of an amber cocktail in a coupe glass, beside a countertop oak aging barrel"
                  width="340" height="480" />
              </picture>
            </div>
          </div>
        </div>
      </li>

      <!-- Sheet 3: Front=Recipe 3 Content, Back=Recipe 4 Title/Photo -->
      <li class="card" style="--i: 3;">
        <div class="page">
          <div class="front ruled-page">
            <div class="recipe-content">
              <h3>Ingredients</h3>
              <ul class="ingredients">
                <li>1&frac12; ounces gin</li>
                <li>&frac34; ounce sweet vermouth</li>
                <li>&frac14; ounce St-Germain elderflower liqueur</li>
                <li>2 dashes peach bitters</li>
                <li>Lemon twist, for garnish</li>
              </ul>
              <h3>Instructions</h3>
              <p class="instructions">In a mixing glass filled with ice, add the gin (1&frac12; oz), vermouth (&frac34;
                oz), St-Germain (&frac14; oz), and bitters (2 dashes). Stir and strain into a chilled coupe glass.
                Garnish with a lemon twist.</p>
            </div>
          </div>
          <div class="back plain-page">
            <div class="recipe-intro">
              <h2>Rob-Fashioned</h2>
              <picture>
                <source type="image/avif" srcset="/images/rob_fashioned_2x.avif 2x, /images/rob_fashioned_1x.avif 1x">
                <img src="/images/rob_fashioned_1x.png" alt="Rob Fashioned" width="340" height="480" />
              </picture>
            </div>
          </div>
        </div>
      </li>

      <!-- Sheet 4: Front=Recipe 4 Content, Back=Recipe 5 Title/Photo -->
      <li class="card" style="--i: 4;">
        <div class="page">
          <div class="front ruled-page">
            <div class="recipe-content">
              <h3>Ingredients</h3>
              <ul class="ingredients">
                <li>2 oz bourbon</li>
                <li>&frac14; oz rich simple syrup (2:1)</li>
                <li>&frac14; oz sweet vermouth</li>
                <li>2-3 dashes Angustura bitters</li>
                <li>Wide-cut orange peel, for garnish</li>
              </ul>
              <h3>Instructions</h3>
              <p class="instructions">In a mixing glass filled with ice, bourbon (2 oz), simple syrup (&frac14; oz),
                sweet vermouth (&frac14;
                oz), and bitters (2-3 dashes). Stir and strain into a rocks glass.</p>
              <p class="instructions">Garnish with a wide-cut orange peel. Bonus points if you add a Luxardo cherry too.
              </p>
              <p class="instructions">If you like your Old Fashioned on the sweeter side, you can add a splash of
                Luxardo cherry syrup, or of course, adjust your simple syrup to your liking.</p>
            </div>
          </div>
          <div class="back plain-page">
            <div class="recipe-intro">
              <h2>Golden Ratio</h2>
              <picture>
                <source type="image/avif" srcset="/images/golden_ratio_2x.avif 2x, /images/golden_ratio_1x.avif 1x">
                <img src="/images/golden_ratio_1x.png" alt="Golden Ratio" width="340" height="480" />
              </picture>
            </div>
          </div>
        </div>
      </li>

      <!-- Sheet 5: Front=Recipe 5 Content, Back=Recipe 6 Title/Photo -->
      <li class="card" style="--i: 5;">
        <div class="page">
          <div class="front ruled-page">
            <div class="recipe-content">
              <h3>Ingredients</h3>
              <ul class="ingredients">
                <li>1&frac12; oz base spirit (whiskey, gin, rum, tequila, etc.)</li>
                <li>&frac34; oz vermouth-like ingredient (sweet, dry, Punt e Mes, Cocchi, etc.)</li>
                <li>&frac14; oz liqueur</li>
                <li>1 or 2 dashes bitters (optional)</li>
              </ul>
              <h3>Instructions</h3>
              <p class="instructions">The Canon Cocktail book calls this the Mr. Potato Head theory and it works
                surprisingly well.</p>
              <p class="instructions">Shake ingredients over ice and strain into a coupe glass. Garnish with a lemon
                twist, orange twist, or cherry.</p>
            </div>
          </div>
          <div class="back plain-page">
            <div class="recipe-intro">
              <h2>Nirvana</h2>
              <picture>
                <source type="image/avif" srcset="/images/nirvana_2x.avif 2x, /images/nirvana_1x.avif 1x">
                <img src="/images/nirvana_1x.png" alt="Nirvana" width="340" height="480" />
              </picture>
            </div>
          </div>
        </div>
      </li>

      <!-- Sheet 6: Front=Recipe 6 Content, Back=Recipe 7 Title/Photo -->
      <li class="card" style="--i: 6;">
        <div class="page">
          <div class="front ruled-page">
            <div class="recipe-content">
              <h3>Ingredients</h3>
              <ul class="ingredients">
                <li>2 ounces bonded rye, 50% abv or stronger</li>
                <li>1 ounce Amer Picon aperitif</li>
                <li>&frac12; ounce maraschino liqueur</li>
                <li>&frac12; ounce B&eacute;n&eacute;dictine</li>
                <li>1 dash Angostura bitters</li>
                <li>Orange twist, for garnish</li>
              </ul>
              <h3>Instructions</h3>
              <p class="instructions">In a mixing glass filled with ice, add the rye (2 oz), Amer Picon (1 oz),
                maraschino liqueur (&frac12; oz), B&eacute;n&eacute;dictine (&frac12; oz), and bitters (1 dash). Stir
                and strain into a chilled coupe glass. Garnish with an orange twist.</p>
            </div>
          </div>
          <div class="back plain-page">
            <div class="recipe-intro">
              <h2>Café Reposado</h2>
              <picture>
                <source type="image/avif" srcset="/images/cafe_reposado_2x.avif 2x, /images/cafe_reposado_1x.avif 1x">
                <img src="/images/cafe_reposado_1x.png" alt="Café Reposado" width="340" height="480" />
              </picture>
            </div>
          </div>
        </div>
      </li>

      <!-- Sheet 7: Front=Recipe 7 Content, Back=Recipe 8 Title/Photo -->
      <li class="card" style="--i: 7;">
        <div class="page">
          <div class="front ruled-page">
            <div class="recipe-content">
              <h3>Ingredients</h3>
              <ul class="ingredients">
                <li>1&frac12; ounces light reposado tequila (Hornitos)</li>
                <li>1 ounce coffee liqueur (Café Granita)</li>
                <li>&frac14; ounce rich simple syrup (2:1)</li>
                <li>2 dashes Angostura bitters</li>
              </ul>
              <h3>Instructions</h3>
              <p class="instructions">Stir to mix all ingredients well over ice. Serve in an old-fashioned glass with a
                large clear ice cube.</p>
            </div>
          </div>
          <div class="back plain-page">
            <div class="recipe-intro">
              <h2>Chamomile Sour</h2>
              <picture>
                <source type="image/avif" srcset="/images/chamomile_sour_2x.avif 2x, /images/chamomile_sour_1x.avif 1x">
                <img src="/images/chamomile_sour_1x.png" alt="Chamomile Sour" width="340" height="480" />
              </picture>
            </div>
          </div>
        </div>
      </li>

      <!-- Sheet 8: Front=Recipe 8 Content, Back=Recipe 9 Title/Photo -->
      <li class="card" style="--i: 8;">
        <div class="page">
          <div class="front ruled-page">
            <div class="recipe-content">
              <h3>Ingredients</h3>
              <ul class="ingredients">
                <li>2 ounces bonded rye, 50% abv or stronger</li>
                <li>1 ounce Amer Picon aperitif</li>
                <li>&frac12; ounce maraschino liqueur</li>
                <li>&frac12; ounce B&eacute;n&eacute;dictine</li>
                <li>1 dash Angostura aromatic bitters</li>
                <li>Orange twist, for garnish</li>
              </ul>
              <h3>Instructions</h3>
              <p class="instructions">In a mixing glass filled with ice, add the rye (2 oz), Amer Picon (1 oz),
                maraschino liqueur (&frac12; oz), B&eacute;n&eacute;dictine (&frac12; oz), and bitters (1 dash). Stir
                and strain into a chilled coupe glass. Garnish with an orange twist.</p>
            </div>
          </div>
          <div class="back plain-page">
            <div class="recipe-intro">
              <h2>Aged Eggnog</h2>
              <picture>
                <source type="image/avif"
                  srcset="/images/sun_liquor_eggnog_2x.avif 2x, /images/sun_liquor_eggnog_1x.avif 1x">
                <img src="/images/sun_liquor_eggnog_1x.png" alt="Sun Liquor Aged Eggnog" width="340" height="480" />
              </picture>
            </div>
          </div>
        </div>
      </li>

      <!-- Sheet 9: Front=Recipe 9 Content, Back=Back Cover -->
      <li class="card" style="--i: 9;">
        <div class="page">
          <div class="front ruled-page">
            <div class="recipe-content">
              <h3>Ingredients</h3>
              <ul class="ingredients">
                <li>3 pasteurized eggs</li>
                <li>&frac18; cup and 1 tablespoon sugar</li>
                <li>1&frac12; ounces brandy or cognac</li>
                <li>1&frac12; ounces bourbon</li>
                <li>1&frac12; ounces molasses rum</li>
                <li>8 ounces whole milk</li>
                <li>8 ounces heavy cream</li>
                <li>Nutmeg</li>
              </ul>
              <h3>Instructions</h3>
              <p class="instructions">Separate egg whites from yolks and place them in separate bowls. Beat the yolks
                with an electric mixer
                until pale yellow.</p>
              <p class="instructions">Slowly add the &frac18; cup sugar. Mix for 30 seconds, then slowly add brandy
                (1&frac12; oz), bourbon
                (1&frac12; oz), rum (1&frac12; oz) and milk (8 oz).</p>
              <p class="instructions">In a separate bowl, beat the egg whites until soft peaks form. Add a tablespoon of
                sugar and mix for 20 seconds.</p>
              <p class="instructions">Add the egg white mixture to the yolk mixture.</p>
              <p class="instructions">In separate bowl, whip the heavy cream until soft peaks form and add it to the egg
                mixture.</p>
              <p class="instructions">Spoon contents together loosely and store in glass container in the back of the
                refrigerator, making
                sure it's 45&deg;F or colder.</p>
              <p class="instructions">Don't open or mix the jar. Let it sit for at least a week. Sun Liquor suggests
                aging closer to a month.</p>
              <p class="instructions">When ready to serve, mix the eggnog with hand mixer and serve in chilled coupe.
                Top with a pinch of fresh ground nutmeg.</p>
            </div>
          </div>
          <div class="back cover-back">
            <h1>Made by Rob</h1>
            <p><svg width="32" height="32" viewBox="0 0 200 200" fill="currentColor">
                <path class="heart-svg"
                  d="M20,70 A40,40,0,0,1,100,70 A40,40,0,0,1,180,70 Q180,130,100,190 Q20,130,20,70 Z" />
              </svg></p>
          </div>
        </div>
      </li>

      <!-- Sheet 10: No content - needed so we can turn to the back cover -->
      <li class="card" style="--i: 10;"></li>
    </ul>
  </main>

  <div class="book-controls">
    <button id="prevBtn" aria-label="Previous Page">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
    </button>
    <button id="nextBtn" aria-label="Next Page">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    </button>
  </div>

  <nav class="notebook-tabs"></nav>

  <script type="text/javascript">
    const main = document.querySelector('main');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const tabsContainer = document.querySelector('.notebook-tabs');
    const cards = document.querySelectorAll('.card');

    // Generate Tabs
    const recipes = document.querySelectorAll('.recipe-intro h2');
    recipes.forEach((recipeTitle, index) => {
      const card = recipeTitle.closest('.card');
      const cardIndex = parseInt(card.style.getPropertyValue('--i'));

      // The recipe is on the BACK of this card.
      // To see the back of card N, we need to scroll to card N+1.
      const targetCardIndex = cardIndex + 1;

      const tab = document.createElement('button');
      tab.className = 'tab';
      tab.innerHTML = `<span>${recipeTitle.innerText}</span>`;
      tab.setAttribute('aria-label', `Go to ${recipeTitle.innerText}`);

      // Stagger the tabs vertically
      tab.style.top = `${(index * 24)}px`;

      tab.addEventListener('click', () => {
        if (cards[targetCardIndex]) {
          cards[targetCardIndex].scrollIntoView({ behavior: 'smooth' });
        }
      });

      tabsContainer.appendChild(tab);
    });

    const focusTabForScroll = (targetScrollTop) => {
      const viewHeight = window.innerHeight;
      const cardIndex = Math.round(targetScrollTop / viewHeight);
      // Recipe 0 is on Card 1. So recipeIndex = cardIndex - 1.
      const recipeIndex = cardIndex - 1;
      const tabs = tabsContainer.querySelectorAll('.tab');

      if (recipeIndex >= 0 && recipeIndex < tabs.length) {
        tabs[recipeIndex].focus();
      } else {
        // If cover or back cover, blur so no tab is expanded
        if (document.activeElement && document.activeElement.classList.contains('tab')) {
          document.activeElement.blur();
        }
      }
    };

    let targetScrollTop = null;
    let scrollTimeout = null;

    const handleNavClick = (direction) => {
      const viewHeight = window.innerHeight;
      const maxScroll = (cards.length - 1) * viewHeight;

      if (targetScrollTop === null) {
        // Snap current position to nearest page to start
        targetScrollTop = Math.round(main.scrollTop / viewHeight) * viewHeight;
      }

      targetScrollTop += direction * viewHeight;

      // Clamp
      targetScrollTop = Math.max(0, Math.min(targetScrollTop, maxScroll));

      main.scrollTo({ top: targetScrollTop, behavior: 'smooth' });
      focusTabForScroll(targetScrollTop);

      // Reset target after animation is likely done so manual scrolling works later
      if (scrollTimeout) clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        targetScrollTop = null;
      }, 800);
    };

    prevBtn.addEventListener('click', () => handleNavClick(-1));
    nextBtn.addEventListener('click', () => handleNavClick(1));

    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') {
        handleNavClick(-1);
      } else if (e.key === 'ArrowRight') {
        handleNavClick(1);
      }
    });

    // Hide tabs on Front/Back Cover
    let tabState = 'VISIBLE'; // FRONT, BACK, VISIBLE

    const updateTabsVisibility = () => {
      const scrollTop = main.scrollTop;
      const viewHeight = window.innerHeight;
      const totalCards = cards.length;

      const isFrontCover = scrollTop < viewHeight * 0.5;
      const isBackCover = scrollTop > (totalCards - 1.5) * viewHeight;

      let newState = 'VISIBLE';
      if (isFrontCover) newState = 'FRONT';
      else if (isBackCover) newState = 'BACK';

      if (newState !== tabState) {
        if (newState === 'BACK') {
          tabsContainer.classList.add('no-transition');
          tabsContainer.classList.add('hidden');
        } else if (newState === 'FRONT') {
          tabsContainer.classList.remove('no-transition');
          tabsContainer.classList.remove('delayed');
          tabsContainer.classList.add('hidden');
        } else {
          // Becoming VISIBLE
          tabsContainer.classList.remove('hidden');
          tabsContainer.classList.remove('no-transition');

          if (tabState === 'BACK') {
            tabsContainer.classList.add('delayed');
            // Remove delay after transition
            setTimeout(() => tabsContainer.classList.remove('delayed'), 1000);
          } else {
            tabsContainer.classList.remove('delayed');
          }
        }
        tabState = newState;
      }
    };

    main.addEventListener('scroll', updateTabsVisibility);
    window.addEventListener('resize', updateTabsVisibility);
    updateTabsVisibility(); // Initial check
  </script>
</body>

</html>